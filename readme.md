# onegen workflow 聊天助手工具

onegen workflow 聊天工具，支持多轮对话，可配置API地址和初始化参数。

## 功能特点

- 支持多轮对话
- 可配置API地址和参数
- 自动保存配置到本地
- 支持限制发送的历史记录数量
- 提供调试信息查看和复制
- 支持复制聊天记录
- 支持清除聊天和配置

## 为什么需要代理服务器？

由于浏览器的同源策略限制，前端页面无法直接向不同域名的API发送请求。为了解决这个跨域问题，我们需要一个代理服务器来转发请求。代理服务器的主要作用是：

1. 解决跨域问题：
   - 浏览器 -> 代理服务器：同源请求
   - 代理服务器 -> API服务器：服务器间请求，不受跨域限制

2. 提供额外功能：
   - 请求转发
   - 错误处理
   - 调试信息

如果您的API服务器已经配置了CORS（跨域资源共享），允许前端直接访问，则可以不使用代理服务器，直接修改前端代码中的请求地址即可。

## 安装和运行

1. 安装依赖：
```bash
npm install
```

2. 启动服务：
```bash
npm start
```

3. 访问地址：
```
http://localhost:3000
```

## 使用说明

### 基本配置

1. API地址：输入完整的API地址，例如：
   - `http://api.example.com/workflow/{workflow-id}`

2. 最大聊天记录数：
   - 设置每次请求携带的历史记录数量
   - 建议设置在1-100之间
   - 数值越大，请求数据量越大

3. 配置信息：JSON格式的配置参数，基本结构如下：
```json
{
    "data": {
        "model": "model-name",
        "chat_histories": [],
        "user": {
            "name": "User"
        },
        "content": "",
        "character": {
            "name": "Assistant",
            "personality": "professional, helpful, and friendly"
        },
        "language": "English"
    }
}
```

### 功能说明

1. 聊天功能：
   - 点击"开始对话"启动聊天
   - 在输入框输入消息并发送
   - 发送过程中会显示加载动画
   - 支持Enter键快速发送

2. 聊天记录：
   - 显示完整的对话历史
   - 可以通过复制按钮复制聊天记录
   - 支持清除所有聊天记录

3. 调试功能：
   - 显示/隐藏调试信息
   - 查看请求和响应数据
   - 支持复制请求数据、响应数据或全部数据

4. 配置管理：
   - 自动保存配置到本地存储
   - 下次打开自动恢复配置
   - 支持清除本地保存的配置

### 快捷操作

1. 复制功能：
   - 点击聊天记录旁的复制图标可复制聊天记录
   - 点击调试信息中的复制图标可复制对应部分
   - 复制成功会有视觉反馈

2. 清除功能：
   - 点击"清除聊天"可清除当前对话
   - 点击配置区域的垃圾桶图标可清除本地保存的配置

### 注意事项

1. API地址必须完整且正确
2. 配置信息必须是有效的JSON格式
3. 最大聊天记录数会影响请求的数据量
4. 本地配置保存在浏览器的localStorage中
5. 如果API服务器支持CORS，可以不使用代理服务器

## 开发说明

- 前端：Vue.js + Axios
- 样式：原生CSS
- 代理服务：Express + http-proxy-middleware（用于解决跨域问题）
- 图标：Font Awesome
- 代码高亮：highlight.js

## 文件结构

- `index.html`: 主页面
- `styles.css`: 样式文件
- `main.js`: Vue应用逻辑
- `server.js`: 代理服务器（用于解决跨域问题）
- `package.json`: 项目配置和依赖

## 问题排查

1. 如果发送失败：
   - 检查API地址是否正确
   - 检查网络连接
   - 查看调试信息中的错误详情
   - 确认代理服务器是否正常运行

2. 如果配置无法保存：
   - 检查JSON格式是否正确
   - 确认浏览器是否支持localStorage
   - 检查浏览器存储空间是否足够

3. 如果代理服务器报错：
   - 检查目标服务器是否可访问
   - 确认API地址格式是否正确
   - 查看服务器控制台的错误日志

## 不使用代理服务器的方案

如果您的API服务器已经配置了CORS，允许跨域访问，您可以：

1. 修改前端代码：
   - 在 `main.js` 中直接使用完整的API地址
   - 移除代理服务器相关的URL转换逻辑

2. API服务器配置要求：
   - 需要设置 `Access-Control-Allow-Origin` 头
   - 需要允许必要的HTTP方法（如POST）
   - 需要允许必要的请求头

3. 启动方式：
   - 不需要启动Node.js服务器
   - 可以直接用任何Web服务器托管静态文件
   - 或直接在浏览器中打开HTML文件